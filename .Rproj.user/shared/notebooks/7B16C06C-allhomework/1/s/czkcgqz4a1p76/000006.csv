"0","library(Ball)"
"0","library(energy)"
"0","library(boot)"
"0","library(RANN)"
"0","m<- 10"
"0","k<- 3"
"0","p<- 2"
"0","mu<- 0.3"
"0","set.seed(233)"
"0","n1<-n2<- 50"
"0","R<- 99"
"0","n<- n1+n2"
"0","N<- c(n1,n2)"
"0","Tn <- function(z, ix, sizes,k) {"
"0","  n1 <- sizes[1]; n2 <- sizes[2]; n <- n1 + n2"
"0","  if(is.vector(z)) z <- data.frame(z,0);"
"0","  z <- z[ix, ];"
"0","  NN <- nn2(data=z, k=k+1) # what's the first column?"
"0","  block1 <- NN$nn.idx[1:n1,-1]"
"0","  block2 <- NN$nn.idx[(n1+1):n,-1]"
"0","  i1 <- sum(block1 < n1 + .5); i2 <- sum(block2 > n1+.5)"
"0","  (i1 + i2) / (k * n)"
"0","}"
"0","eqdist.nn <- function(z,sizes,k){"
"0","  boot.obj <- boot(data=z,statistic=Tn,R=R,"
"0","                   sim = ""permutation"", sizes = sizes,k=k)"
"0","  ts <- c(boot.obj$t0,boot.obj$t)"
"0","  p.value <- mean(ts>=ts[1])"
"0","  list(statistic=ts[1],p.value=p.value)"
"0","}"
"0","p1.values <- matrix(NA,m,3)"
"0","for(i in 1:m){"
"0","  x <- matrix(rnorm(n1*p,0,1.5),ncol=p);"
"0","  y <- cbind(rnorm(n2),rnorm(n2,mean=0.3));"
"0","  z <- rbind(x,y)"
"0","  p1.values[i,1] <- eqdist.nn(z,N,k)$p.value"
"0","  p1.values[i,2] <- eqdist.etest(z,sizes=N,R=R)$p.value"
"0","  p1.values[i,3] <- bd.test(x=x,y=y,num.permutations=999,seed=i*12345)$p.value"
"0","}"
"0","alpha <- 0.1;"
"0","pow1 <- colMeans(p1.values<alpha)"
"0","pow1#上课的示例"
"1","[1]"
"1"," 0.1"
"1"," 0.7"
"1"," 0.9"
"1","
"
"0","p2.values <- matrix(NA,m,3)"
"0","for(i in 1:m){"
"0","  x <- matrix(rnorm(n1*p,0,1.6),ncol=p);"
"0","  y <- matrix(rnorm(n2*p,0,1),ncol=p);"
"0","  z <- rbind(x,y)"
"0","  p2.values[i,1] <- eqdist.nn(z,N,k)$p.value"
"0","  p2.values[i,2] <- eqdist.etest(z,sizes=N,R=R)$p.value"
"0","  p2.values[i,3] <- bd.test(x=x,y=y,num.permutations=999,seed=i*12345)$p.value"
"0","}"
"0","alpha <- 0.1"
"0","pow2 <- colMeans(p2.values<alpha)"
"0","pow2#等均值不等方差"
"1","[1]"
"1"," 0.5"
"1"," 0.5"
"1"," 0.8"
"1","
"
"0","p3.values <- matrix(NA,m,3)"
"0","for(i in 1:m){"
"0","  x <- matrix(rnorm(n1*p,0.3,1.4),ncol=p);"
"0","  y <- matrix(rnorm(n2*p,0,1),ncol=p);"
"0","  z <- rbind(x,y)"
"0","  p3.values[i,1] <- eqdist.nn(z,N,k)$p.value"
"0","  p3.values[i,2] <- eqdist.etest(z,sizes=N,R=R)$p.value"
"0","  p3.values[i,3] <- bd.test(x=x,y=y,num.permutations=999,seed=i*12345)$p.value"
"0","}"
"0","alpha <- 0.1"
"0","pow3 <- colMeans(p3.values<alpha)"
"0","pow3#不等均值不等方差"
"1","[1]"
"1"," 0.3"
"1"," 0.5"
"1"," 0.7"
"1","
"
"0","p4.values <- matrix(NA,m,3)"
"0","for(i in 1:m){"
"0","  x <- matrix(rt(n1*p,1) ,ncol=p)"
"0","  yy<- 1:n2*p"
"0","  a<- matrix(0,2,n2*p)"
"0","  a[1,]<- rnorm(n2*p,mean = -.1,2)"
"0","  a[2,]<- rnorm(n2*p,mean = .1,2)"
"0","  index<- sample(c(1,2),p*n2,replace = T,prob = c(.5,.5))"
"0","  for (j in 1:100) {"
"0","    yy[j]<-a[index[j],j]"
"0","  }"
"0","  y<-matrix(yy,ncol = p)"
"0","  z <- rbind(x,y)"
"0","  p4.values[i,1] <- eqdist.nn(z,N,k)$p.value"
"0","  p4.values[i,2] <- eqdist.etest(z,sizes=N,R=R)$p.value"
"0","  p4.values[i,3] <- bd.test(x=x,y=y,num.permutations=999,seed=i*12345)$p.value"
"0","}"
"0","alpha <- 0.1"
"0","pow4 <- colMeans(p4.values<alpha)"
"0","pow4#自由度为1的t分布"
"1","[1]"
"1"," 0.3"
"1"," 0.5"
"1"," 0.5"
"1","
"
"0","p5.values <- matrix(NA,m,3)"
"0","for(i in 1:m){"
"0","  x <- matrix(rt(n1*p,1) ,ncol=p)"
"0","  yy<- 1:n2*p"
"0","  a<- matrix(0,2,n2*p)"
"0","  a[1,]<- rnorm(n2*p,mean = -0.01,2)"
"0","  a[2,]<- rnorm(n2*p,mean = 0.01,2)"
"0","  index<- sample(c(1,2),p*n2,replace = T,prob = c(.5,.5))"
"0","  for (j in 1:100) {"
"0","    yy[j]<-a[index[j],j]"
"0","  }"
"0","  y<-matrix(yy,ncol = p)"
"0","  z <- rbind(x,y)"
"0","  p5.values[i,1] <- eqdist.nn(z,N,k)$p.value"
"0","  p5.values[i,2] <- eqdist.etest(z,sizes=N,R=R)$p.value"
"0","  p5.values[i,3] <- bd.test(x=x,y=y,num.permutations=999,seed=i*12345)$p.value"
"0","}"
"0","alpha <- 0.1"
"0","pow5 <- colMeans(p5.values<alpha)"
"0","pow5 #自由度为1的t分布和双正态"
"1","[1]"
"1"," 0.3"
"1"," 0.5"
"1"," 0.5"
"1","
"
"0","p6.values <- matrix(NA,m,3)"
"0","for(i in 1:m){"
"0","  x <- matrix(rnorm(100*p,0,1.5),ncol=p);"
"0","  y <- cbind(rnorm(10),rnorm(10));"
"0","  z <- rbind(x,y)"
"0","  p6.values[i,1] <- eqdist.nn(z,N,k)$p.value"
"0","  p6.values[i,2] <- eqdist.etest(z,sizes=c(100,10),R=R)$p.value"
"0","  p6.values[i,3] <- bd.test(x=x,y=y,num.permutations=999,seed=i*12345)$p.value"
"0","}"
"0","alpha <- 0.1;"
"0","pow6 <- colMeans(p6.values<alpha)"
"0","pow6#不平衡样本"
"1","[1]"
"1"," 0.0"
"1"," 0.1"
"1"," 0.8"
"1","
"
